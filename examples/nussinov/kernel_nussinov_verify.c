#include <stdio.h>
#include <unistd.h>
#include <string.h>
#include <math.h>
#include <stdlib.h>


typedef char base;


void kernel_nussinov(int n, base seq[ n + 0],
      int table[ n + 0][n + 0]);


static
void *
xmalloc (size_t num)
{
  void* cur = NULL;
  int ret = 0;
  #ifdef __unix__ 
	  ret = posix_memalign (&cur, 32, num);
  #elif defined(_WIN32) || defined(WIN32) 
	  cur = _aligned_malloc(num, 32);
	  printf("cur windows: %p", cur);
  #endif
  
  if (! cur || ret)
    {
      fprintf (stderr, "[PolyBench] posix_memalign/_aligned_malloc: cannot allocate memory");
      exit (1);
    }
  return cur;
}


void* polybench_alloc_data(unsigned long long int n, int elt_size)
{
  /// FIXME: detect overflow!
  size_t val = n;
  val *= elt_size;
  void* ret = xmalloc (val);

  return ret;
}


static
void init_array (int n,
                 base seq[ n + 0],
   int table[ n + 0][n + 0])
{
  int i, j;


  for (i=0; i <n; i++) {
     seq[i] = (base)((i+1)%4);
  }

  for (i=0; i <n; i++)
     for (j=0; j <n; j++)
       table[i][j] = 0;
}




static
void print_array(int n,
   int table[ n + 0][n + 0])

{
  int i, j;
  int t = 0;

  fprintf(stderr, "==BEGIN DUMP_ARRAYS==\n");
  fprintf(stderr, "begin dump: %s", "table");
  for (i = 0; i < n; i++) {
    for (j = 0; j < n; j++) {    // for (j = i; j < n; j++) {
      if (t % 20 == 0) fprintf (stderr, "\n");
      fprintf (stderr, "%d ", table[i][j]);
      t++;
    }
  }
  fprintf(stderr, "\nend   dump: %s\n", "table");
  fprintf(stderr, "==END   DUMP_ARRAYS==\n");
}


int table_expected[60][60] = { 0,0,0,0,1,2,2,2,3,4,4,4,5,6,6,6,7,8,8,8,
9,10,10,10,11,12,12,12,13,14,14,14,15,16,16,16,17,18,18,18,
19,20,20,20,21,22,22,22,23,24,24,24,25,26,26,26,27,28,28,28,
0,0,0,0,1,1,1,2,3,3,3,4,5,5,5,6,7,7,7,8,
9,9,9,10,11,11,11,12,13,13,13,14,15,15,15,16,17,17,17,18,
19,19,19,20,21,21,21,22,23,23,23,24,25,25,25,26,27,27,27,28,
0,0,0,0,0,0,1,2,2,2,3,4,4,4,5,6,6,6,7,8,
8,8,9,10,10,10,11,12,12,12,13,14,14,14,15,16,16,16,17,18,
18,18,19,20,20,20,21,22,22,22,23,24,24,24,25,26,26,26,27,28,
0,0,0,0,0,0,1,1,1,2,3,3,3,4,5,5,5,6,7,7,
7,8,9,9,9,10,11,11,11,12,13,13,13,14,15,15,15,16,17,17,
17,18,19,19,19,20,21,21,21,22,23,23,23,24,25,25,25,26,27,27,
0,0,0,0,0,0,0,0,1,2,2,2,3,4,4,4,5,6,6,6,
7,8,8,8,9,10,10,10,11,12,12,12,13,14,14,14,15,16,16,16,
17,18,18,18,19,20,20,20,21,22,22,22,23,24,24,24,25,26,26,26,
0,0,0,0,0,0,0,0,1,1,1,2,3,3,3,4,5,5,5,6,
7,7,7,8,9,9,9,10,11,11,11,12,13,13,13,14,15,15,15,16,
17,17,17,18,19,19,19,20,21,21,21,22,23,23,23,24,25,25,25,26,
0,0,0,0,0,0,0,0,0,0,1,2,2,2,3,4,4,4,5,6,
6,6,7,8,8,8,9,10,10,10,11,12,12,12,13,14,14,14,15,16,
16,16,17,18,18,18,19,20,20,20,21,22,22,22,23,24,24,24,25,26,
0,0,0,0,0,0,0,0,0,0,1,1,1,2,3,3,3,4,5,5,
5,6,7,7,7,8,9,9,9,10,11,11,11,12,13,13,13,14,15,15,
15,16,17,17,17,18,19,19,19,20,21,21,21,22,23,23,23,24,25,25,
0,0,0,0,0,0,0,0,0,0,0,0,1,2,2,2,3,4,4,4,
5,6,6,6,7,8,8,8,9,10,10,10,11,12,12,12,13,14,14,14,
15,16,16,16,17,18,18,18,19,20,20,20,21,22,22,22,23,24,24,24,
0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,2,3,3,3,4,
5,5,5,6,7,7,7,8,9,9,9,10,11,11,11,12,13,13,13,14,
15,15,15,16,17,17,17,18,19,19,19,20,21,21,21,22,23,23,23,24,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,2,2,3,4,
4,4,5,6,6,6,7,8,8,8,9,10,10,10,11,12,12,12,13,14,
14,14,15,16,16,16,17,18,18,18,19,20,20,20,21,22,22,22,23,24,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,2,3,3,
3,4,5,5,5,6,7,7,7,8,9,9,9,10,11,11,11,12,13,13,
13,14,15,15,15,16,17,17,17,18,19,19,19,20,21,21,21,22,23,23,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,2,2,
3,4,4,4,5,6,6,6,7,8,8,8,9,10,10,10,11,12,12,12,
13,14,14,14,15,16,16,16,17,18,18,18,19,20,20,20,21,22,22,22,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,2,
3,3,3,4,5,5,5,6,7,7,7,8,9,9,9,10,11,11,11,12,
13,13,13,14,15,15,15,16,17,17,17,18,19,19,19,20,21,21,21,22,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,
2,2,3,4,4,4,5,6,6,6,7,8,8,8,9,10,10,10,11,12,
12,12,13,14,14,14,15,16,16,16,17,18,18,18,19,20,20,20,21,22,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,
1,2,3,3,3,4,5,5,5,6,7,7,7,8,9,9,9,10,11,11,
11,12,13,13,13,14,15,15,15,16,17,17,17,18,19,19,19,20,21,21,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
1,2,2,2,3,4,4,4,5,6,6,6,7,8,8,8,9,10,10,10,
11,12,12,12,13,14,14,14,15,16,16,16,17,18,18,18,19,20,20,20,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
1,1,1,2,3,3,3,4,5,5,5,6,7,7,7,8,9,9,9,10,
11,11,11,12,13,13,13,14,15,15,15,16,17,17,17,18,19,19,19,20,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,1,2,2,2,3,4,4,4,5,6,6,6,7,8,8,8,9,10,
10,10,11,12,12,12,13,14,14,14,15,16,16,16,17,18,18,18,19,20,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,1,1,1,2,3,3,3,4,5,5,5,6,7,7,7,8,9,9,
9,10,11,11,11,12,13,13,13,14,15,15,15,16,17,17,17,18,19,19,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,1,2,2,2,3,4,4,4,5,6,6,6,7,8,8,8,
9,10,10,10,11,12,12,12,13,14,14,14,15,16,16,16,17,18,18,18,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,1,1,1,2,3,3,3,4,5,5,5,6,7,7,7,8,
9,9,9,10,11,11,11,12,13,13,13,14,15,15,15,16,17,17,17,18,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,1,2,2,2,3,4,4,4,5,6,6,6,7,8,
8,8,9,10,10,10,11,12,12,12,13,14,14,14,15,16,16,16,17,18,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,1,1,1,2,3,3,3,4,5,5,5,6,7,7,
7,8,9,9,9,10,11,11,11,12,13,13,13,14,15,15,15,16,17,17,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,1,2,2,2,3,4,4,4,5,6,6,6,
7,8,8,8,9,10,10,10,11,12,12,12,13,14,14,14,15,16,16,16,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,1,1,1,2,3,3,3,4,5,5,5,6,
7,7,7,8,9,9,9,10,11,11,11,12,13,13,13,14,15,15,15,16,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,1,2,2,2,3,4,4,4,5,6,
6,6,7,8,8,8,9,10,10,10,11,12,12,12,13,14,14,14,15,16,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,1,1,1,2,3,3,3,4,5,5,
5,6,7,7,7,8,9,9,9,10,11,11,11,12,13,13,13,14,15,15,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,1,2,2,2,3,4,4,4,
5,6,6,6,7,8,8,8,9,10,10,10,11,12,12,12,13,14,14,14,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,2,3,3,3,4,
5,5,5,6,7,7,7,8,9,9,9,10,11,11,11,12,13,13,13,14,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,2,2,3,4,
4,4,5,6,6,6,7,8,8,8,9,10,10,10,11,12,12,12,13,14,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,2,3,3,
3,4,5,5,5,6,7,7,7,8,9,9,9,10,11,11,11,12,13,13,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,2,2,
3,4,4,4,5,6,6,6,7,8,8,8,9,10,10,10,11,12,12,12,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,2,
3,3,3,4,5,5,5,6,7,7,7,8,9,9,9,10,11,11,11,12,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,
2,2,3,4,4,4,5,6,6,6,7,8,8,8,9,10,10,10,11,12,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,
1,2,3,3,3,4,5,5,5,6,7,7,7,8,9,9,9,10,11,11,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
1,2,2,2,3,4,4,4,5,6,6,6,7,8,8,8,9,10,10,10,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
1,1,1,2,3,3,3,4,5,5,5,6,7,7,7,8,9,9,9,10,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,1,2,2,2,3,4,4,4,5,6,6,6,7,8,8,8,9,10,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,1,1,1,2,3,3,3,4,5,5,5,6,7,7,7,8,9,9,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,1,2,2,2,3,4,4,4,5,6,6,6,7,8,8,8,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,1,1,1,2,3,3,3,4,5,5,5,6,7,7,7,8,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,1,2,2,2,3,4,4,4,5,6,6,6,7,8,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,1,1,1,2,3,3,3,4,5,5,5,6,7,7,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,1,2,2,2,3,4,4,4,5,6,6,6,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,1,1,1,2,3,3,3,4,5,5,5,6,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,1,2,2,2,3,4,4,4,5,6,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,1,1,1,2,3,3,3,4,5,5,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,1,2,2,2,3,4,4,4,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,2,3,3,3,4,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,2,2,3,4,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,2,3,3,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,2,2,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,2,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 };


int main(int argc, char** argv)
{

  int n = 60;


  base (*seq)[n + 0]; seq = (base(*)[n + 0])polybench_alloc_data (n + 0, sizeof(base));;
  int (*table)[n + 0][n + 0]; table = (int(*)[n + 0][n + 0])polybench_alloc_data ((n + 0) * (n + 0), sizeof(int));;


  init_array (n, *seq, *table);
  kernel_nussinov (n, *seq, *table);


  if (argc > 42 && ! strcmp(argv[0], "")) print_array(n, *table);


//  print_array(n, *table);

  int i, j;
  for(i=0; i < n; i++) {
        for(j=0; j < n; j++) {
                if((*table)[i][j] != table_expected[i][j]) {
  			free((void*)seq);
  			free((void*)table);
			return 1; 
                }
        }
  }

  free((void*)seq);
  free((void*)table);
  return 10;
}
